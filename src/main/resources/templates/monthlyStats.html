{#include base}
{#title}Monthly stats{/title}

{#body}
<div class="ui main container">
    <div class="ui icon message">
        <i class="small sync icon"></i>
        <div class="content">
            <p>Updated {inject:prettyTime.format(stats.updated)} (refreshed every 6 hours).</p>
        </div>
    </div>

    <h2>Pull Request created per month in QuarkusIO GitHub organisation</h2>
    <div class="ui message">
        <canvas id="canvas-stacked-quarkusio-prs-created"></canvas>
    </div>

    <h2>Pull Request reviewed per month in QuarkusIO GitHub organisation</h2>
    <div class="ui message">
        <canvas id="canvas-stacked-quarkusio-prs-reviewed"></canvas>
    </div>

    <h2>Issues reported per month in QuarkusIO GitHub organisation</h2>
    <div class="ui message">
        <canvas id="canvas-stacked-quarkusio-issues-reported"></canvas>
    </div>

    <h2>Issues assigned per month in QuarkusIO GitHub organisation</h2>
    <div class="ui message">
        <canvas id="canvas-stacked-quarkusio-issues-assigned"></canvas>
    </div>

    <h2>Issues participant per month in QuarkusIO GitHub organisation</h2>
    <div class="ui message">
        <canvas id="canvas-stacked-quarkusio-issues-participant"></canvas>
    </div>
</div>
{/body}
{#scripts}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script>
			var barIssuesReported = {
				type: 'bar',
				data: {
					labels: [
					    {#for month in stats.months}
                            "{month}",
                        {/for}
					],
					datasets: [
                    {#for entry in stats.quarkusioIssuesReported}
                    {
						label: '{entry.key}',
						backgroundColor: getColor({index}),
						data: [
						{#for value in entry.value}
                            {value},
                        {/for}
						]
					},
                    {/for}
					]
				},
				options: {
					onClick: barChartClickIssuesReported,
					title: { display: true,	text: 'Issues reported per month in QuarkusIO GitHub organisation' },
					tooltips: { mode: 'index', intersect: false },
					legend: { onHover: function(e) { e.target.style.cursor = 'pointer'; } },
					hover: { onHover: (event, chartElement) => { event.target.style.cursor = chartElement[0] ? 'pointer' : 'default'; } },
					responsive: true,
					scales: {
						xAxes: [{ stacked: true }],
						yAxes: [{ stacked: true, scaleLabel: { display: true, labelString: 'Number of reported Issues'} }]
					}
				}
			};
			var barIssuesAssigned = {
				type: 'bar',
				data: {
					labels: [
					    {#for month in stats.months}
                            "{month}",
                        {/for}
					],
					datasets: [
                    {#for entry in stats.quarkusioIssuesAssigned}
                    {
						label: '{entry.key}',
						backgroundColor: getColor({index}),
						data: [
						{#for value in entry.value}
                            {value},
                        {/for}
						]
					},
                    {/for}
					]
				},
				options: {
					onClick: barChartClickIssuesAssigned,
					title: { display: true,	text: 'Issues assigned per month in QuarkusIO GitHub organisation' },
					tooltips: { mode: 'index', intersect: false },
					legend: { onHover: function(e) { e.target.style.cursor = 'pointer'; } },
					hover: { onHover: (event, chartElement) => { event.target.style.cursor = chartElement[0] ? 'pointer' : 'default'; } },
					responsive: true,
					scales: {
						xAxes: [{ stacked: true }],
						yAxes: [{ stacked: true, scaleLabel: { display: true, labelString: 'Number of assigned Issues'} }]
					}
				}
			};
			var barIssuesParticipant = {
				type: 'bar',
				data: {
					labels: [
					    {#for month in stats.months}
                            "{month}",
                        {/for}
					],
					datasets: [
                    {#for entry in stats.quarkusioIssuesParticipant}
                    {
						label: '{entry.key}',
						backgroundColor: getColor({index}),
						data: [
						{#for value in entry.value}
                            {value},
                        {/for}
						]
					},
                    {/for}
					]
				},
				options: {
					onClick: barChartClickIssuesParticipant,
					title: { display: true,	text: 'Issues participant per month in QuarkusIO GitHub organisation' },
					tooltips: { mode: 'index', intersect: false },
					legend: { onHover: function(e) { e.target.style.cursor = 'pointer'; } },
					hover: { onHover: (event, chartElement) => { event.target.style.cursor = chartElement[0] ? 'pointer' : 'default'; } },
					responsive: true,
					scales: {
						xAxes: [{ stacked: true }],
						yAxes: [{ stacked: true, scaleLabel: { display: true, labelString: 'Number of participant Issues'} }]
					}
				}
			};
			var barPullsCreated = {
				type: 'bar',
				data: {
					labels: [
					    {#for month in stats.months}
                            "{month}",
                        {/for}
					],
					datasets: [
                    {#for entry in stats.quarkusioPRsCreated}
                    {
						label: '{entry.key}',
						backgroundColor: getColor({index}),
						data: [
						{#for value in entry.value}
                            {value},
                        {/for}
						]
					},
                    {/for}
					]
				},
				options: {
					onClick: barChartClickPullsCreated,
					title: { display: true,	text: 'Pull Requests created per month in QuarkusIO GitHub organisation' },
					tooltips: { mode: 'index', intersect: false },
					legend: { onHover: function(e) { e.target.style.cursor = 'pointer'; } },
					hover: { onHover: (event, chartElement) => { event.target.style.cursor = chartElement[0] ? 'pointer' : 'default'; } },
					responsive: true,
					scales: {
						xAxes: [{ stacked: true }],
						yAxes: [{ stacked: true, scaleLabel: { display: true, labelString: 'Number of created PRs'} }]
					}
				}
			};
			var barPullsReviewed = {
				type: 'bar',
				data: {
					labels: [
					    {#for month in stats.months}
                            "{month}",
                        {/for}
					],
					datasets: [
                    {#for entry in stats.quarkusioPRsReviewed}
                    {
						label: '{entry.key}',
						backgroundColor: getColor({index}),
						data: [
						{#for value in entry.value}
                            {value},
                        {/for}
						]
					},
                    {/for}
					]
				},
				options: {
					onClick: barChartClickPullsReviewed,
					title: { display: true,	text: 'Pull Requests reviewed per month in QuarkusIO GitHub organisation' },
					tooltips: { mode: 'index', intersect: false },
					legend: { onHover: function(e) { e.target.style.cursor = 'pointer'; } },
					hover: { onHover: (event, chartElement) => { event.target.style.cursor = chartElement[0] ? 'pointer' : 'default'; } },
					responsive: true,
					scales: {
						xAxes: [{ stacked: true }],
						yAxes: [{ stacked: true, scaleLabel: { display: true, labelString: 'Number of reviwed PRs'} }]
					}
				}
			};

			function barChartClickIssuesReported(event, array){
				if(array[0]) {
					// console.table(array[0]._model);
					var activePoint = window.barChartIssuesReported.getElementAtEvent(event)[0];
					var selectedLogin = getLogin(activePoint._datasetIndex)
					window.open("https://github.com/search?q=author:" + selectedLogin + "+created:" + array[0]._model.label + "+is:issue+org:quarkusio", '_blank');
				}
			}
			function barChartClickIssuesAssigned(event, array){
				if(array[0]) {
					// console.table(array[0]._model);
					var activePoint = window.barChartIssuesAssigned.getElementAtEvent(event)[0];
					var selectedLogin = getLogin(activePoint._datasetIndex)
					window.open("https://github.com/search?q=assignee:" + selectedLogin + "+created:" + array[0]._model.label + "+is:issue+org:quarkusio", '_blank');
				}
			}
			function barChartClickIssuesParticipant(event, array){
				if(array[0]) {
					// console.table(array[0]._model);
					var activePoint = window.barChartIssuesParticipant.getElementAtEvent(event)[0];
					var selectedLogin = getLogin(activePoint._datasetIndex)
					window.open("https://github.com/search?q=commenter:" + selectedLogin + "+created:" + array[0]._model.label + "+is:issue+org:quarkusio", '_blank');
				}
			}
			function barChartClickPullsCreated(event, array){
				if(array[0]) {
					// console.table(array[0]._model);
					var activePoint = window.barChartPullsCreated.getElementAtEvent(event)[0];
					var selectedLogin = getLogin(activePoint._datasetIndex)
					window.open("https://github.com/search?q=author:" + selectedLogin + "+created:" + array[0]._model.label + "+is:pr+org:quarkusio", '_blank');
				}
			}
			function barChartClickPullsReviewed(event, array){
				if(array[0]) {
					// console.table(array[0]._model);
					var activePoint = window.barChartPullsReviewed.getElementAtEvent(event)[0];
					var selectedLogin = getLogin(activePoint._datasetIndex)
					window.open("https://github.com/search?q=reviewed-by:" + selectedLogin + "+-author:" + selectedLogin + "+created:" + array[0]._model.label + "+is:pr+org:quarkusio", '_blank');
				}
			}
			function getColor(index) {
			    if (index == 0) { return 'rgba(255, 99, 132, 0.8)'}
			    if (index == 1) { return 'rgba(255, 159, 64, 0.8)'}
			    if (index == 2) { return 'rgba(255, 205, 86, 0.8)'}
			    if (index == 3) { return 'rgba(75, 192, 192, 0.8)'}
			    if (index == 4) { return 'rgba(54, 162, 245, 0.8)'}
			    if (index == 5) { return 'rgba(153, 102, 255, 0.8)'}
			    if (index == 6) { return 'rgba(191, 201, 202, 0.8)'}
                var letters = '0123456789ABCDEF'.split('');
                var color = '#';
                for (var i = 0; i < 6; i++ ) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }
			function getLogin(index) {
			    {#for login in logins}
                    if (index == {index}) { return "{login}"}
                {/for}
            }

			window.onload = function() {
				var ctxIssuesReported = document.getElementById('canvas-stacked-quarkusio-issues-reported').getContext('2d');
				var ctxIssuesAssigned = document.getElementById('canvas-stacked-quarkusio-issues-assigned').getContext('2d');
				var ctxIssuesParticipant = document.getElementById('canvas-stacked-quarkusio-issues-participant').getContext('2d');
				var ctxPullsCreated = document.getElementById('canvas-stacked-quarkusio-prs-created').getContext('2d');
				var ctxPullsReviewed = document.getElementById('canvas-stacked-quarkusio-prs-reviewed').getContext('2d');

				window.barChartIssuesReported = new Chart(ctxIssuesReported, barIssuesReported);
				window.barChartIssuesAssigned = new Chart(ctxIssuesAssigned, barIssuesAssigned);
				window.barChartIssuesParticipant = new Chart(ctxIssuesParticipant, barIssuesParticipant);
				window.barChartPullsCreated = new Chart(ctxPullsCreated, barPullsCreated);
				window.barChartPullsReviewed = new Chart(ctxPullsReviewed, barPullsReviewed);

			};
		</script>
{/scripts}
{/include}
